<!DOCTYPE html>
<html >
<head >
        <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>



<!--<meta charset="UTF-8">-->
<!--<title>TodoApp - Create A Todo With Django</title>-->
{% load static %}
    <style>

        .color{
        background-color:rgb(255, 179, 102);
        margin-right:700px;
        margin-top: 40px;
        }

        .orderlist{
        font-weight: bold;
        text-align:center;
        background-color:rgb(255, 153, 51);
        margin-right:100px;
        }

        .description{
        text-align:center;
        margin-right:100px;
        }

        .author{
        text-align:left;
        position: absolute;
        margin-top:0px;
        }

        .due_date{
        text-align:right;
        position: relative;
        margin-top:0px;
        }




    </style>

</head>


<body style="background: url(https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmiKdq0GcFtvHgZIvIpy7erorqM5wT9T9Vj4z3OlD7WIBQm--y4g);background-repeat: no-repeat;background-size: 5000px;">


<title>TodoApp - Create A Todo With Django</title>
<div class="container">
<div class="content">
<h1>TodoApp</h1>

<form id = "new_user_form" action="" method="post">
{% csrf_token %} <!-- csrf token for basic security -->

        <p id="msg3"></p>
    <div >
        <label >AUTHOR</label>
        <input type="text" id="author" placeholder="Please enter a author name" name="author">
        <span id ="msg0"></span>
    </div>
    <div >
        <label >TITLE</label>
        <input type="text" id="title" placeholder="Title of the Task" name="title">
        <span id="msg2"></span>
    </div>
    <div >
        <label>DESCRIPTION</label>
        <input type="text" id="description" placeholder="Task description" name="description">
        <span id="msg1"></span>
    </div>
    <div >
        <label>DUEDATE</label>
        <input type="date" id="duedate" name="duedate" >
        <span id="msg">
        </span>

    </div>
    <div >
        <button name="taskAdd" id="btn" type="submit" value="SUBMIT">Add task</button>
    </div>
</form>

</div>
</div>

<div id="codeing">
    <form id="fid"   action="" method="post">
        {% csrf_token %} <!-- csrf token for basic security -->
       {% for todo in todos %}
        <div id="{{todo.id}}" name='{{todo.id}}' style="background-color:rgb(255, 179, 102);margin-right:700px;margin-top: 40px;">
            <p id="todoid" name="todoid">{{todo.id}}</p>
        <ol style= "text-align:center;background-color:rgb(255, 153, 51);margin-right:100px;"> <b> {{todo.title}} </b> </ol>
        <p style= "text-align:center;margin-right:100px;">{{ todo.description }} </p>
        <p style=  "text-align:left;position: absolute;margin-top:0px;">{{ todo.author }}
        <span> <p id="duee" style= "text-align:right;position: relative;margin-top:0px">{{ todo.due_date }}</p> </span></p>
        <button id="delete" name="delete" value = "{{todo.id}}" type="button" onclick="ondeleting(this.value)" >DELETE</button>
            <button type="button" name="upd{{todo.id}}" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal{{todo.id}}">Update</button>
        </div>


    </form>


<div id="myModal{{todo.id}}" class="modal fade" role="dialog">
                <div class="modal-dialog">
       <div class="modal-content">
      <div class="modal-header">
        <div class="modal-body">
          <form id = "anew_user_form" action="" method="post">
           {% csrf_token %} <!-- csrf token for basic security -->
        <p id="atodoid" name="todoid">{{todos.id}}</p>
        <p id="amsg3"></p>
               <div >
        <input type="hidden" id="id" name="id" value="{{ todo.id }}">
    </div>
    <div >
        <label >AUTHOR</label>
        <input type="text" id="aauthor" placeholder="Please enter a author name" name="author" value="{{ todo.author }}">
        <span id ="amsg0"></span>
    </div>
    <div >
        <label >TITLE</label>
        <input type="text" id="atitle" placeholder="Title of the Task" name="title" value="{{todo.title}}">
        <span id="amsg2"></span>
    </div>
    <div >
        <label>DESCRIPTION</label>
        <input type="text" id="adescription" placeholder="Task description" name="description" value="{{ todo.description }}">
        <span id="amsg1"></span>
    </div>
    <div >
        <label>DUEDATE</label>
        <input type="date" id="aduedate" name="duedate" value="{{ todo.due_date }}" >
        <span id="amsg">
        </span>

    </div>
    <div >
        <button id="update" name="update" value ={{todo.id}} >Update Task new</button>
    </div>

</form>

        </div>


          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
    </div>
        {% endfor %}
    </form>
</div>

</body>


<script type= "text/javascript">
    $(document).ready(function(){


    $(document).on('submit', '#new_user_form', '#fid', function(e){

       $('#msg1').html('')
       $('#msg').html('')
       $('#msg2').html('')
       $('#msg3').html('')
       $('#msg0').html('')



    e.preventDefault();

    $.ajax({
       type : 'POST',
       url : 'http://127.0.0.1:8000/todo/',
       data : {
            author : $('#author').val(),
            description : $('#description').val(),
            title : $('#title').val(),
            duedate : $('#duedate').val(),
            csrfmiddlewaretoken: $('input[name = csrfmiddlewaretoken]').val()
            },


            success: function(json) {

                a = 'asdf';
                alert('New task created!'+a)
                $('#author').val('');
                $('#description').val('');
                $('#title').val('');
                $('#duedate').val('');
                $('#fid').prepend("<form id ="+json.id+" action='' method='post'><div id='sample'><input type='hidden' name='csrfmiddlewaretoken' value='r70iRI18IKaVZkPHYV8rGTqMNotUTpMuSwFXiBkHt1Xbt0JttKxWU8LjLXJNjj0I'><div class='color'><span><p class='id' id="+json.id+" name="+json.id+" value="+json.id+">"+json.id+"</p></span><ol class='orderlist'>"+json.title+"</ol><p class='description'>"+json.description+"</p><p class='author'>"+json.author+"</p><span><p class='due_date'>"+json.due_date+"</p></span><input type='button' id="+json.id+" value='Delete' onclick=ondelete(this.id)></input></div></form>")
<!--                $('#fid').prepend('<p>'+json.id+'</p>')-->




            },
            error: function(json){
                $('#msg0').html(json.responseJSON.data0.message_0)
                $('#msg').html(json.responseJSON.data3.message)
                $('#msg1').html(json.responseJSON.data2.message_1)
                $('#msg2').html(json.responseJSON.data1.message_2)
            }

         });


         });
         });

</script>


<script type= "text/javascript">
       $(document).ready(function(e){
       console.log(e,"hii")
<!--       $(document).on('click', '#update', '#anew_user_form', function(e){-->
       $('#update').bind('click','#anew_user_form',function(e){
       console.log('alpha')
       $('#amsg1').html('')
       $('#amsg').html('')
       $('#amsg2').html('')
       $('#amsg3').html('')
       $('#amsg0').html('')
    e.preventDefault();
       console.log("hello")
    $.ajax({
       type : 'POST',
       url : 'http://127.0.0.1:8000/todo/',
       data : {
            id: $('#id').val(),
            author : $('#aauthor').val(),
            description : $('#adescription').val(),
            title : $('#atitle').val(),
            duedate : $('#aduedate').val(),
            csrfmiddlewaretoken: $('input[name = csrfmiddlewaretoken]').val()
            },
            success: function(json) {
                alert('task updated!!!')
            },
            error: function(json){
            console.log(json,'ccc')
            console.log('checking html')
                $('#amsg0').html(json.responseJSON.data0.message_0)
                console.log('error message check')
                $('#amsg').html(json.responseJSON.data3.message)
                $('#amsg1').html(json.responseJSON.data2.message_1)
                $('#amsg2').html(json.responseJSON.data1.message_2)
            }

         });
         });
         });
</script>


 <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>

<script type="text/javascript">

    function ondelete(val){
    var delet =  val;
    console.log(delet, 'abcd')
       $.ajax({
       type : 'POST',
       url : 'http://127.0.0.1:8000/todo/',
       data : {
            delete : delet,
            csrfmiddlewaretoken: $('input[name = csrfmiddlewaretoken]').val()
            },
            success: function() {
                alert('delete suceeded')
               $( document.getElementById(val).remove());

            },
            error: function(){
            alert("error delete");
            }

         });
    }

    </script>
<script type="text/javascript">

    function ondeleting(val){
    var del = val;
    $.ajax({
       type : 'POST',
       url : 'http://127.0.0.1:8000/todo/',
       data : {
            delete : del,
            csrfmiddlewaretoken: $('input[name = csrfmiddlewaretoken]').val()
            },
            success: function() {
                alert('delete suceeded')
                console.log(document.getElementById(val),'aaa')
                $( document.getElementById(val).remove());

            },
            error: function(){
            alert("error delete");
            }

         });
    }

    </script>




</html>